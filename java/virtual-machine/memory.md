## 一、Java内存区域

**方法区（公有）：** 用户存储已被虚拟机加载的类信息，常量，静态常量，即时编译器编译后的代码等数据。异常状态 OutOfMemoryError

其中包含常量池：用户存放编译器生成的各种字面量和符号引用。

**堆（公有）：** 是JVM所管理的内存中最大的一块。唯一目的就是存放实例对象，几乎所有的对象实例都在这里分配。Java堆是垃圾收集器管理的主要区域，因此很多时候也被称为“GC堆”。异常状态 OutOfMemoryError

**虚拟机栈（线程私有）：** 描述的是java方法执行的内存模型：每个方法在执行时都会创建一个栈帧，用户存储局部变量表，操作数栈，动态连接，方法出口等信息。每一个方法从调用直至完成的过程，就对应着一个栈帧在虚拟机栈中入栈到出栈的过程。 对这个区域定义了两种异常状态 OutOfMemoryError StackOverflowError

**本地方法栈（线程私有）:** 与虚拟机栈所发挥的作用相似。它们之间的区别不过是虚拟机栈为虚拟机执行java方法，而本地方法栈为虚拟机使用到的Native方法服务。

**程序计数器（线程私有）：** 一块较小的内存，当前线程所执行的字节码的行号指示器。字节码解释器工作时，就是通过改变这个计数器的值来选取下一条需要执行的字节码指令。

  


![](http://upload-images.jianshu.io/upload_images/3985563-02c2481f2a39225e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## 二、Java内存模型

**Java内存模型的目的：** 屏蔽掉各种硬件和操作系统的内存访问差异，以实现让java程序在各种平台下都能达到一致的内存访问效果。

**主要目标：** 定义程序中各个变量的访问规则，即在虚拟机中将变量存储到内存和从内存中取出变量这样的底层细节。此处的变量与Java变成中所说的变量是有所区别，它包括了实例字段，静态字段和构成数组对象的元素，但不包括局部变量和方法参数。

**Java内存模型规定了所有的变量都存储在主内存中。每条线程中还有自己的工作内存，线程的工作内存中保存了被该线程所使用到的变量（这些变量是从主内存中拷贝而来）。线程对变量的所有操作（读取，赋值）都必须在工作内存中进行。不同线程之间也无法直接访问对方工作内存中的变量，线程间变量值的传递均需要通过主内存来完成。**

****

![](http://upload-images.jianshu.io/upload_images/3985563-7db5daa99dd1f3c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


关于主内存与工作内存之间具体的交互协议，即一个变量如何从主内存拷贝到工作内存、如何从工作内存同步回主内存之类的实现细节，Java内存模型中定义了8种操作来完成，并且每种操作都是原子的、不可再分的。

### 八种操作：

| 类型   | 说明                                                                                                         |
|--------|--------------------------------------------------------------------------------------------------------------|
| lock   | 作用于主内存的变量，把一个变量标识为一条线程独占的状态                                                       |
| unlock | 作用于主内存的变量，把一个处于锁定状态的变量释放出来。                                                       |
| read   | 把一个变量的值从主内存传输到工作内存中，以便随后的load使用。                                                 |
| load   | 把read操作从主内存中得到的变量值放入到工作内存的变量副本中。                                                 |
| use    | 把工作内存中一个变量的值传递给执行引擎，每当虚拟机遇到一个需要使用变量的值的字节码指令时将会执行这个操作。   |
| assign | 把一个从执行引擎中接收到的值赋值给工作内存中的变量，每当虚拟机遇到一个给变量赋值的字节码指令时执行这个操作。 |
| store  | 把工作内存中的一个变量的值传递到主内存，以便随后的write使用。                                                |
| write  | 把store操作从工作内存中得到的变量值放入到主内存的变量中。                                                    |

